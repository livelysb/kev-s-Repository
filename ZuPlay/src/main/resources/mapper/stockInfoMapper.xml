<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosta.zuplay.model.dao.stock.StockInfoDAO">

	<resultMap type="masterDTO" id="master">
		<result column="isuKorAbbrv" property="isuKorAbbrv" />
		<association property="priceDTO" javaType="priceDTO">
			<result column="cmpprevddPrc" property="cmpprevddPrc" />
			<result column="trdPrc" property="trdPrc" />
			<result column="trdvol" property="trdvol" />
			<result column="opnprc" property="opnprc" />
			<result column="hgprc" property="hgprc" />
			<result column="lwprc" property="lwprc" />
		</association>
	</resultMap>

	<select id="getLists" resultType="ListsDTO">
		select * from lists
	</select>

	<select id="getPrices" resultType="priceDTO">
		select * from price
	</select>

	<select id="getPrice" parameterType="String" resultType="priceDTO">
		select *
		from price where isuCd=#{value}
	</select>

	<select id="getStockList" parameterType="java.util.Map"
		resultMap="master">
		
		select * from ( SELECT * FROM (          
    SELECT ROW_NUMBER() OVER(ORDER BY  prevddAccTrdvol desc) rnum, isuCd, isuSrtCd, isuKorAbbrv, govncExcelYn, haltYn, mktcapScaleCd, mfindYn, krxAutosSectidxYn, krxSemiconSectidxYn, krxBioSectidxYn, krxFncSectidxYn, 
krxInfoCommSectidxYn, krxEnergyChemSectidxYn, krxSteelSectidxYn, krxConsgoodSectidxYn, krxMediaCommSectidxYn, krxConstrSectidxYn, krxFncSvcSectidxYn, krxSecuSectidxYn,
krxShipSectidxYn, prevddAccTrdvol, prevddAccTrdval, uplmtprc, lwlmtprc, parval, listShrs, krxInsuSectidxYn, krxTransSectidxYn, krxRetailSectidxYn, krxLeisureSectidxYn FROM master
<where>
		<if test="isuKorAbbrv!='undefined'">
			isuKorAbbrv like '%${isuKorAbbrv}%'
		</if>
</where>
	       ) WHERE rnum >= #{startPage} AND rnum &lt;= #{endPage} ) m join price p on m.isucd = p.isucd
	        
	</select>
	
</mapper>